# 🛠️ Audio2txt 收費版技術棧建議

> 針對收費模式的最佳技術選型與成本效益分析

**制定日期**: 2025-09-30
**目標**: 雲端 SaaS 平台

---

## 🎯 技術選型原則

### 收費版 vs 免費版的差異

| 考量因素 | 免費版（本地） | 收費版（雲端） |
|---------|---------------|---------------|
| **成本** | 使用者自付 | 公司負擔，需優化 |
| **品質** | 盡力而為 | 需保證 SLA |
| **速度** | 本地 GPU 速度 | 需更快（雲端優勢）|
| **規模** | 單一使用者 | 多租戶架構 |
| **API** | 無需 API 費用 | 可使用商業 API |

---

## 🤖 AI 模型選擇

### 1. 轉錄引擎

#### 方案 A：Faster-Whisper（當前）⭐⭐⭐⭐
**模型**: `Systran/faster-whisper-large-v3`

**優點**:
- ✅ 完全免費（MIT License）
- ✅ 高準確度（~95%）
- ✅ 支援中文優化
- ✅ GPU 加速（RTF 0.08x）
- ✅ 本地處理（隱私）

**缺點**:
- ❌ 需要 GPU 實例（$120/月）
- ❌ 準確度略低於 Whisper API

**成本**: GPU 實例費用
**建議**: **保留作為主要方案** ✅

---

#### 方案 B：OpenAI Whisper API
**端點**: `https://api.openai.com/v1/audio/transcriptions`

**優點**:
- ✅ 最高準確度（~98%）
- ✅ 無需 GPU
- ✅ 按量計費
- ✅ 自動更新模型

**缺點**:
- ❌ 付費（$0.006/分鐘）
- ❌ 隱私疑慮（上傳到 OpenAI）
- ❌ 網路延遲

**成本計算**:
```
專業版用戶: 1,200 分鐘/月
成本: 1,200 × $0.006 = $7.2/月/用戶
收入: $9.99/月/用戶
毛利: $2.79/月/用戶（28% 毛利率）
```
❌ **毛利率過低，不建議**

---

#### 方案 C：混合策略 ⭐⭐⭐⭐⭐ **推薦**

**架構**:
```
使用者請求 → 智能路由 → 選擇引擎

1. 短音訊（<5 分鐘）→ Whisper API（速度優先）
2. 長音訊（>5 分鐘）→ Faster-Whisper（成本優先）
3. 高價值客戶（企業版）→ Whisper API（品質優先）
```

**優點**:
- ✅ 靈活成本控制
- ✅ 最佳品質/成本平衡
- ✅ 差異化服務

**成本估算**:
```
假設專業版用戶:
- 30% 短音訊（Whisper API）: 360 分鐘 × $0.006 = $2.16
- 70% 長音訊（Faster-Whisper）: 840 分鐘 × $0 = $0
總成本: $2.16/月/用戶
毛利: $9.99 - $2.16 = $7.83（78% 毛利率）✅
```

**建議**: **採用混合策略** 🎯

---

### 2. 說話人分離（Diarization）

#### 方案 A：Pyannote 3.1（當前）⭐⭐⭐⭐⭐
**模型**: `pyannote/speaker-diarization-3.1`

**優點**:
- ✅ 免費（MIT License）
- ✅ 準確度高
- ✅ 本地處理

**缺點**:
- ❌ 需要 GPU
- ❌ 處理較慢

**成本**: 包含在 GPU 實例費用內
**建議**: **保留** ✅

---

#### 方案 B：AssemblyAI Speaker Diarization
**端點**: `https://api.assemblyai.com/v2/transcript`

**優點**:
- ✅ 準確度極高
- ✅ 無需 GPU
- ✅ 與轉錄整合

**缺點**:
- ❌ 付費（$0.015/分鐘）
- ❌ 成本過高

**成本**: $0.015/分鐘（太貴）
**建議**: ❌ **不採用**

---

#### 結論：保持 Pyannote 3.1 ✅

---

### 3. 智能摘要（LLM）

#### 方案 A：Ollama + gpt-oss:20b（當前）⭐⭐⭐
**模型**: 本地部署 `gpt-oss:20b`

**優點**:
- ✅ 完全免費
- ✅ 隱私保護
- ✅ 無限制使用

**缺點**:
- ❌ 需要 GPU（額外成本）
- ❌ 品質一般（7-8/10）
- ❌ 需維護模型

**成本**: GPU 實例費用（已包含）
**建議**: **作為免費版選項** ✅

---

#### 方案 B：OpenAI GPT-4o ⭐⭐⭐⭐⭐ **推薦**
**模型**: `gpt-4o-2025-xx-xx`

**優點**:
- ✅ 最高品質（9-10/10）
- ✅ 最新功能（結構化輸出）
- ✅ 快速響應
- ✅ 無需維護

**缺點**:
- ❌ 付費

**成本計算**:
```
輸入: 假設每次摘要 5,000 tokens（約 100 個片段）
輸出: 假設 1,000 tokens

價格:
- 輸入: $2.50 / 1M tokens
- 輸出: $10.00 / 1M tokens

單次摘要成本:
(5,000 × $2.50 / 1,000,000) + (1,000 × $10.00 / 1,000,000)
= $0.0125 + $0.01
= $0.0225（約 $0.02）

假設每用戶每月生成 20 次摘要:
20 × $0.02 = $0.40/月/用戶

毛利計算:
收入: $9.99/月
成本: Whisper $2.16 + GPT-4o $0.40 = $2.56
毛利: $7.43（74% 毛利率）✅✅
```

**建議**: **專業版使用 GPT-4o** 🎯

---

#### 方案 C：Claude 3.5 Sonnet ⭐⭐⭐⭐⭐ **同等推薦**
**模型**: `claude-3-5-sonnet-20250227`

**優點**:
- ✅ 品質與 GPT-4o 相當
- ✅ 更好的中文理解
- ✅ 更便宜（某些情況）
- ✅ 200K context window

**成本**:
```
價格:
- 輸入: $3.00 / 1M tokens
- 輸出: $15.00 / 1M tokens

單次摘要:
(5,000 × $3.00 / 1M) + (1,000 × $15.00 / 1M)
= $0.015 + $0.015
= $0.03

每用戶每月: 20 × $0.03 = $0.60/月
```

**對比**:
| 模型 | 單次成本 | 月成本 | 品質 | 速度 |
|------|---------|--------|------|------|
| gpt-oss:20b | $0 | $0 | 7/10 | 慢 |
| GPT-4o | $0.02 | $0.40 | 10/10 | 快 |
| Claude 3.5 | $0.03 | $0.60 | 10/10 | 快 |

**建議**:
- **專業版**: GPT-4o（成本最優）✅
- **企業版**: Claude 3.5（品質最優）✅
- **免費版**: gpt-oss:20b（本地）✅

---

#### 方案 D：混合智能策略 ⭐⭐⭐⭐⭐ **最終推薦**

```python
def select_llm_model(user_tier, content_length):
    """智能選擇 LLM 模型"""

    if user_tier == "free":
        return "gpt-oss:20b"  # 本地處理

    elif user_tier == "pro":
        if content_length < 1000:  # 短內容
            return "gpt-4o-mini"  # 更便宜
        else:
            return "gpt-4o"  # 標準

    elif user_tier == "business":
        return "claude-3.5-sonnet"  # 最高品質
```

**成本優化**:
```
GPT-4o-mini 價格:
- 輸入: $0.15 / 1M tokens（便宜 17 倍！）
- 輸出: $0.60 / 1M tokens

適用場景:
- 快速摘要
- 關鍵詞提取
- 簡單問答

成本: $0.003/次（vs $0.02）
節省: 85% 🎉
```

---

### 4. Ask AI（RAG 系統）

#### 核心技術棧

##### 4.1 Embedding 模型

**方案 A**: OpenAI `text-embedding-3-small` ⭐⭐⭐⭐
```
價格: $0.02 / 1M tokens
向量維度: 1536
品質: 優秀
```

**方案 B**: 本地 `sentence-transformers` ⭐⭐⭐⭐⭐ **推薦**
```
模型: all-MiniLM-L6-v2
價格: $0（免費）
向量維度: 384
品質: 良好（滿足需求）
```

**建議**: **使用本地 Sentence Transformers** ✅
- 免費
- 快速
- 品質足夠

---

##### 4.2 向量資料庫

**方案對比**:

| 資料庫 | 類型 | 成本 | 效能 | 推薦度 |
|--------|------|------|------|--------|
| **Qdrant** | 自架 | $0（包含在伺服器） | 極快 | ⭐⭐⭐⭐⭐ |
| Pinecone | SaaS | $70/月起 | 快 | ⭐⭐ |
| Weaviate | 自架 | $0 | 快 | ⭐⭐⭐⭐ |
| ChromaDB | 嵌入式 | $0 | 中等 | ⭐⭐⭐ |

**建議**: **Qdrant（自架）** 🎯
- 完全免費
- 效能極佳
- Docker 部署簡單
- 支援多租戶

---

### 5. 思維導圖生成

#### 方案 A：Mermaid.js ⭐⭐⭐⭐⭐ **推薦**

**技術**:
```javascript
// LLM 生成 Mermaid 語法
graph TD
    A[會議概況] --> B[核心決策]
    A --> C[討論重點]
    B --> D[行動項目]
```

**優點**:
- ✅ 免費
- ✅ 支援 Markdown
- ✅ 可匯出 PNG/SVG
- ✅ 互動式

**實現**:
1. GPT-4o 生成 Mermaid 語法
2. 前端渲染（mermaid.js）
3. 匯出圖片（puppeteer）

**成本**: $0（包含在 GPT-4o API 成本內）

---

#### 方案 B：Graphviz
**優點**: 更專業的圖表
**缺點**: 需要後端渲染

**建議**: 作為進階選項

---

## 🏗️ 完整技術棧總結

### 免費版（本地處理）

| 層級 | 技術 | 成本 |
|------|------|------|
| 轉錄 | Faster-Whisper large-v3 | $0 |
| 說話人分離 | Pyannote 3.1 | $0 |
| 摘要 | gpt-oss:20b（Ollama） | $0 |
| 向量資料庫 | ChromaDB（本地） | $0 |
| **總成本** | | **$0** |

**使用者需求**: GPU（使用者自備）

---

### 專業版（雲端 SaaS）⭐ 推薦配置

| 層級 | 技術 | 月成本/用戶 |
|------|------|------------|
| **轉錄** | Faster-Whisper（主）+ Whisper API（輔）| $2.16 |
| **說話人分離** | Pyannote 3.1 | $0 |
| **摘要** | GPT-4o-mini + GPT-4o | $0.30 |
| **Ask AI** | GPT-4o + Sentence Transformers | $0.20 |
| **向量資料庫** | Qdrant（自架） | $0 |
| **思維導圖** | Mermaid.js + GPT-4o | $0.10 |
| **基礎設施** | GPU 實例（分攤） | $1.50 |
| **總成本** | | **$4.26** |

**收入**: $9.99/月
**毛利**: $5.73（**57% 毛利率**）✅✅

---

### 企業版（高品質）

| 層級 | 技術 | 月成本/用戶 |
|------|------|------------|
| 轉錄 | Whisper API（全量） | $7.20 |
| 說話人分離 | Pyannote 3.1 | $0 |
| 摘要 | Claude 3.5 Sonnet | $0.80 |
| Ask AI | Claude 3.5 + OpenAI Embedding | $0.40 |
| 向量資料庫 | Qdrant（專用實例） | $2.00 |
| 思維導圖 | Graphviz + Claude | $0.20 |
| SLA 保證 | 冗餘與監控 | $3.00 |
| **總成本** | | **$13.60** |

**收入**: $49/月
**毛利**: $35.40（**72% 毛利率**）✅✅✅

---

## 🔧 基礎設施

### 雲端選擇

#### AWS（推薦）⭐⭐⭐⭐⭐

**GPU 實例**: `g4dn.xlarge`
- 4 vCPU
- 16 GB RAM
- 1x NVIDIA T4 GPU（16GB）
- 價格: ~$0.526/小時 = **$380/月**（24/7）

**優點**:
- ✅ 成熟穩定
- ✅ 全球節點
- ✅ 豐富服務
- ✅ Spot 實例（省 70%）

**Spot 實例優化**:
```
正常: $380/月
Spot: $114/月（省 $266）

策略: 混合使用
- 70% Spot（處理排隊任務）
- 30% On-Demand（即時處理）
平均成本: $194/月
```

---

#### GCP（備選）

**GPU 實例**: `n1-standard-4` + T4 GPU
- 價格: ~$400/月

**優點**: 更便宜的 Spot 實例

---

### 應用架構

```
┌─────────────────────────────────────────────────┐
│                  Load Balancer                   │
│                  (AWS ALB)                       │
└────────────┬────────────────────────┬────────────┘
             │                        │
             ▼                        ▼
┌─────────────────────┐  ┌─────────────────────┐
│    Web Server       │  │    Web Server       │
│    (FastAPI)        │  │    (FastAPI)        │
│    • API 端點       │  │    • 負載均衡       │
│    • 使用者認證     │  │    • 自動擴展       │
└─────────┬───────────┘  └─────────┬───────────┘
          │                        │
          └────────────┬───────────┘
                       ▼
┌─────────────────────────────────────────────────┐
│              Task Queue (Celery)                 │
│              • Redis 佇列                        │
│              • 異步處理                          │
└────────────┬────────────────────────────────────┘
             ▼
┌─────────────────────────────────────────────────┐
│            Worker Nodes (GPU)                    │
│            • Faster-Whisper                      │
│            • Pyannote                            │
│            • 本地 LLM（可選）                     │
└─────────────────────────────────────────────────┘
             ▼
┌─────────────────────────────────────────────────┐
│              Storage & Database                  │
│              • S3（音訊檔案）                     │
│              • PostgreSQL（元資料）               │
│              • Qdrant（向量）                     │
│              • Redis（快取）                      │
└─────────────────────────────────────────────────┘
             ▼
┌─────────────────────────────────────────────────┐
│            External APIs (可選)                  │
│            • OpenAI（Whisper + GPT-4o）          │
│            • Anthropic（Claude）                 │
└─────────────────────────────────────────────────┘
```

---

## 💰 總成本分析

### 月度成本（假設 50 位專業版用戶）

| 項目 | 成本 |
|------|------|
| GPU 實例（Spot 優化） | $194 |
| Web Server（t3.medium × 2） | $60 |
| PostgreSQL（db.t3.small） | $25 |
| Redis（cache.t3.micro） | $12 |
| S3 儲存（50GB） | $1 |
| 流量（100GB） | $9 |
| API 費用（OpenAI + Anthropic） | $150 |
| 監控（CloudWatch） | $15 |
| 其他 | $20 |
| **總計** | **$486/月** |

**收入**: 50 × $9.99 = $499/月
**淨利**: $13/月

⚠️ **太少！需要規模化**

---

### 規模化後（250 位專業版用戶）

| 項目 | 成本 |
|------|------|
| GPU 實例 × 2 | $388 |
| Web Server（擴展） | $100 |
| 資料庫（擴展） | $60 |
| API 費用 | $750 |
| 其他 | $100 |
| **總計** | **$1,398/月** |

**收入**: 250 × $9.99 = $2,497/月
**淨利**: **$1,099/月**（44% 淨利率）✅

---

## 🎯 最終建議

### 技術選型總結

| 層級 | 免費版 | 專業版 | 企業版 |
|------|--------|--------|--------|
| **轉錄** | Faster-Whisper | 混合策略 | Whisper API |
| **說話人分離** | Pyannote | Pyannote | Pyannote |
| **摘要** | gpt-oss:20b | GPT-4o | Claude 3.5 |
| **Ask AI** | 本地 | GPT-4o + ST | Claude + OpenAI |
| **向量資料庫** | ChromaDB | Qdrant | Qdrant 專用 |
| **基礎設施** | 使用者 GPU | AWS Spot | AWS On-Demand |

### 成本效益比

| 方案 | 月收入 | 月成本 | 毛利率 | 推薦度 |
|------|--------|--------|--------|--------|
| 免費版 | $0 | $0 | - | ⭐⭐⭐ |
| 專業版 | $9.99 | $4.26 | 57% | ⭐⭐⭐⭐⭐ |
| 企業版 | $49 | $13.60 | 72% | ⭐⭐⭐⭐⭐ |

### 關鍵成功因素

1. **Spot 實例**：省 70% GPU 成本
2. **混合 LLM**：GPT-4o-mini 處理簡單任務
3. **本地 Embedding**：避免 API 費用
4. **自架 Qdrant**：避免 SaaS 費用
5. **智能路由**：根據任務選擇最佳引擎

---

## 🚀 實施優先級

### Phase 1（立即）
1. ✅ 保持 Faster-Whisper + Pyannote（免費版）
2. ⏳ 整合 OpenAI Whisper API（專業版）
3. ⏳ 整合 GPT-4o-mini + GPT-4o（專業版）

### Phase 2（1 個月）
4. ⏳ 部署 Qdrant 向量資料庫
5. ⏳ 實現 Ask AI（RAG）
6. ⏳ 思維導圖生成（Mermaid.js）

### Phase 3（3 個月）
7. ⏳ Claude 3.5 整合（企業版）
8. ⏳ Spot 實例優化
9. ⏳ 自動擴展與監控

---

**結論：採用混合智能策略，在品質、成本和靈活性之間取得最佳平衡！** 🎯💰

---

**文件版本**: v1.0
**最後更新**: 2025-09-30